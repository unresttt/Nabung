<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Aplikasi Tabungan</title>

  <script>
    const APP_VERSION = '2.1.0';
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('link[rel="stylesheet"], script[src], link[rel="manifest"], link[rel="icon"]').forEach(el => {
        const attr = el.tagName === 'SCRIPT' ? 'src' : 'href';
        const url = new URL(el.getAttribute(attr), location.origin);
        url.searchParams.set('v', APP_VERSION);
        el.setAttribute(attr, url.toString());
      });
    });
  </script>

  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon-192.png" sizes="192x192">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main id="app">
    <header class="app-header">
      <div class="logo">💰</div>
      <h1>Aplikasi Tabungan</h1>
    </header>

    <div id="tabs-wrapper">
      <div id="tabs" class="tabs-inner">
        <section class="tab" id="tab-targets">
          <h2>🎯 Daftar Target Tabungan</h2>
          <button id="btn-add-target" class="btn green">+ Tambah Target</button>
          <div id="targets-list" class="card-list"></div>
        </section>

        <section class="tab" id="tab-meet">
          <h2>🤝 Tabungan Tiap Ketemu & ⚠️ Denda</h2>
          <div class="card">
            <h3>Tabungan Tiap Ketemu</h3>
            <p class="amount" id="meet-amount">Rp 0</p>
            <div class="controls">
              <button id="meet-add" class="btn blue">Tabung +</button>
              <button id="meet-reset" class="btn red">Reset</button>
            </div>
          </div>

          <div class="divider"></div>

          <div class="card">
            <h3>Denda</h3>
            <p class="amount" id="penalty-amount">Rp 0</p>
            <div class="controls">
              <button id="penalty-add" class="btn blue">Tabung +</button>
              <button id="penalty-reset" class="btn red">Reset</button>
            </div>
          </div>
        </section>

        <section class="tab" id="tab-total">
          <h2>💵 Total Keseluruhan</h2>
          <div class="big-card">
            <p class="big-amount" id="total-amount">Rp 0</p>
            <p class="muted">Total gabungan semua tabungan, target, dan denda</p>
          </div>
        </section>

        <section class="tab" id="tab-history">
          <h2>📜 Riwayat Transaksi</h2>
          <ul id="transactions-list" class="tx-list"></ul>
          <button id="clear-history" class="btn red">Hapus Riwayat</button>
        </section>
      </div>
    </div>

    <nav id="dots" class="dots"></nav>

    <div id="modal" class="modal hidden">
      <div class="modal-card">
        <h3 id="modal-title">Tambah Target</h3>
        <input id="target-name" placeholder="Nama target" />
        <input id="target-amount" placeholder="Nominal target" inputmode="numeric" />
        <div class="modal-actions">
          <button id="modal-cancel" class="btn muted">Batal</button>
          <button id="modal-save" class="btn green">Simpan</button>
        </div>
      </div>
    </div>

    <button id="toggle-theme" class="fab" aria-label="Toggle theme">🌙</button>
  </main>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="app-legacy.js"></script>
</body>
</html>
