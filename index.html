<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aplikasi Tabungan</title>

  <script>
    // Buat versi unik berdasar waktu (anti-cache)
    const now = new Date();
    const app_version =
      now.getFullYear().toString() +
      (now.getMonth() + 1).toString().padStart(2, "0") +
      now.getDate().toString().padStart(2, "0") +
      "-" +
      now.getHours().toString().padStart(2, "0") +
      now.getMinutes().toString().padStart(2, "0") +
      now.getSeconds().toString().padStart(2, "0");
    console.log("Aplikasi Tabungan v" + app_version);

    // Fungsi untuk menulis elemen dengan versi unik
    document.write(`
      <link rel="manifest" href="manifest.json?v=${app_version}">
      <link rel="icon" href="icon-192.png" sizes="192x192">
      <link rel="stylesheet" href="style.css?v=${app_version}">
    `);
  </script>
</head>

<body>
  <main id="app">
    <header class="app-header">
      <div class="logo">ğŸ’°</div>
      <h1>Aplikasi Tabungan</h1>
    </header>

    <section id="tabs" class="tabs">
      <!-- TAB TARGET -->
      <div class="tab" id="tab-targets">
        <h2>ğŸ¯ Daftar Target Tabungan</h2>
        <button id="btn-add-target" class="btn green">+ Tambah Target</button>
        <div id="targets-list" class="card-list"></div>
      </div>

      <!-- TAB TIAP KETEMU / DENDA -->
      <div class="tab" id="tab-meet">
        <h2>ğŸ¤ Tabungan Tiap Ketemu & âš ï¸ Denda</h2>

        <div class="card">
          <h3>Tabungan Tiap Ketemu</h3>
          <p class="amount" id="meet-amount">Rp 0</p>
          <div class="controls">
            <button id="meet-add" class="btn blue">Tabung +</button>
            <button id="meet-reset" class="btn red">Reset</button>
          </div>
        </div>

        <div class="divider"></div>

        <div class="card">
          <h3>Denda</h3>
          <p class="amount" id="penalty-amount">Rp 0</p>
          <div class="controls">
            <button id="penalty-add" class="btn blue">Tabung +</button>
            <button id="penalty-reset" class="btn red">Reset</button>
          </div>
        </div>
      </div>

      <!-- TAB TOTAL -->
      <div class="tab" id="tab-total">
        <h2>ğŸ’µ Total Keseluruhan</h2>
        <div class="big-card">
          <p class="big-amount" id="total-amount">Rp 0</p>
          <p class="muted">Total gabungan semua tabungan, target, dan denda</p>
        </div>
      </div>

      <!-- TAB RIWAYAT -->
      <div class="tab" id="tab-history">
        <h2>ğŸ“œ Riwayat Transaksi</h2>
        <ul id="transactions-list" class="tx-list"></ul>
        <button id="clear-history" class="btn red">Hapus Riwayat</button>
      </div>
    </section>

    <nav id="dots" class="dots"></nav>

    <!-- Modal Target -->
    <div id="modal" class="modal hidden">
      <div class="modal-card">
        <h3 id="modal-title">Tambah Target</h3>
        <input id="target-name" placeholder="Nama target" />
        <input id="target-amount" placeholder="Nominal target" inputmode="numeric" />
        <div class="modal-actions">
          <button id="modal-cancel" class="btn muted">Batal</button>
          <button id="modal-save" class="btn green">Simpan</button>
        </div>
      </div>
    </div>

    <button id="toggle-theme" class="fab">ğŸŒ™</button>
  </main>

  <!-- Firebase SDK (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <!-- File utama (pakai versi unik biar selalu terbaru) -->
  <script>
    document.write(`<script src="app-legacy.js?v=${app_version}"><\\/script>`);
  </script>
</body>
</html>
